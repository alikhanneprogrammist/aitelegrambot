"""
Менеджер офисных расходов
"""
import sys
import os
from typing import List, Dict, Any

# Добавляем путь к родительской директории
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from base_expense_manager import BaseExpenseManager


class OfficeExpenseManager(BaseExpenseManager):
    """Менеджер офисных расходов"""
    
    def __init__(self, excel_file_path: str):
        # Постоянные офисные расходы
        fixed_office_expenses = [
            {"category": "аренда офиса", "amount": 450000, "payment_method": "карта", "comments": ""},
            {"category": "коммунальные услуги", "amount": 129000, "payment_method": "карта", "comments": "офис"},
            {"category": "вода", "amount": 8800, "payment_method": "карта", "comments": ""},
            {"category": "уборка офиса", "amount": 24000, "payment_method": "карта", "comments": ""}
        ]
    
        super().__init__(excel_file_path, 'office', fixed_office_expenses)
    
    def _create_categorization_prompt(self, text: str) -> str:
        """Создает промпт для категоризации офисных расходов"""
        return f"""
            Проанализируй следующий текст о расходе и определи категорию из списка:
            
            Доступные категории:
            - аренда офиса (аренда помещения, офисное пространство)
            - коммунальные услуги (электричество, отопление, вода для офиса, газ)
            - канцелярия (ручки, бумага, офисные принадлежности, блокноты, папки)
            - техника (компьютеры, принтеры, оргтехника, серверы, мониторы)
            - связь (интернет, телефония для офиса, мобильная связь)
            - уборка офиса (клининг, уборка, химчистка)
            - ремонт (ремонт офиса, мебели, техники)
            - маркетинг (реклама, продвижение, SMM, контекстная реклама)
            - транспорт (доставка, курьерские услуги, такси для офиса)
            - мебель (столы, стулья, шкафы, диваны для офиса)
            - программное обеспечение (лицензии, подписки, SaaS)
            - обучение персонала (курсы, тренинги, семинары для сотрудников)
            - юридические услуги (консультации, документооборот, регистрация)
            - бухгалтерские услуги (ведение учета, отчетность, аудит)
            - страхование (страхование офиса, оборудования, сотрудников)
            - банковские услуги (обслуживание счетов, комиссии, переводы)
            - прочее (все остальное)
            
            Текст: "{text}"
            
            Верни только название категории в формате JSON:
            {{"category": "название_категории", "confidence": 0.95}}
            """
            
    def _create_analysis_prompt(self, category_summary, total_amount: float) -> str:
        """Создает промпт для анализа офисных расходов"""
        return f"""
            Проанализируй офисные расходы за последние 30 дней и дай рекомендации по оптимизации:
            
            Общая сумма: {total_amount:,.0f} тенге
            
            Расходы по категориям:
            {chr(10).join([f"- {cat}: {amount:,.0f} тенге ({amount/total_amount*100:.1f}%)" for cat, amount in category_summary.items()])}
            
            Дай краткий анализ (2-3 предложения) и 3 практических совета по оптимизации офисных расходов.
            """
            
